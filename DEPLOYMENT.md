## Деплой приложения на VDS

Это инструкция для первого деплоя твоего to‑do приложения на VDS.  
Будем считать, что на сервере стоит Ubuntu/Debian и есть доступ по SSH.

---

## 1. Подключение к серверу по SSH

```bash
ssh user@VDS_IP
```

- **`user`** — имя пользователя на сервере (часто `root` или созданный тобой пользователь).
- **`VDS_IP`** — IP-адрес твоего сервера.
- Если SSH работает на нестандартном порту (например, `2222`), добавь `-p`:

```bash
ssh -p 2222 user@VDS_IP
```

После этой команды ты оказываешься “внутри” сервера — все следующие команды выполняются уже на VDS.

---

## 2. Установка Node.js, npm и Git

```bash
sudo apt update
sudo apt install -y nodejs npm git
```

- `sudo apt update` — обновляет список доступных пакетов.
- `sudo apt install ...` — устанавливает Node.js, npm (менеджер пакетов для Node) и Git.

Проверь, что всё установилось:

```bash
node -v
npm -v
git --version
```

Каждая команда должна вывести версию программы (например, `v18.x.x`).

---

## 3. Клонирование проекта с GitHub

Перейдём в домашнюю директорию пользователя и склонируем репозиторий:

```bash
cd ~
git clone https://github.com/yourinho/vibe-todo-app.git
cd vibe-todo-app
```

- `git clone ...` — скачивает твой код с GitHub на сервер.
- `cd vibe-todo-app` — заходим в папку проекта.

Если репозиторий приватный, Git может запросить логин/пароль/токен — укажи те же данные, что использовал для `git push` с локального компьютера.

---

## 4. Установка зависимостей проекта

Находясь в папке проекта (`vibe-todo-app`):

```bash
npm install
```

- Эта команда читает `package.json` и скачивает все необходимые библиотеки (Express, sqlite и т.д.).
- Папка `node_modules` создаётся на сервере автоматически.

Если команда прошла без ошибок — зависимости установлены.

---

## 5. Тестовый запуск приложения (порт 3000)

```bash
npm start
```

- Сервер запустится и будет слушать порт `3000` (как указано в `server.js`).
- Терминал “зависнет” — это нормально, значит сервер работает.

Теперь с твоего компьютера попробуй открыть в браузере:

```text
http://VDS_IP:3000
```

Если видишь своё to‑do приложение — всё работает.

Чтобы остановить сервер, нажми в SSH-сессии:

```text
Ctrl + C
```

---

## 6. Установка и базовая настройка nginx (прокси на порт 3000)

Так как файерволл пропускает только порт `80` (HTTP) и порты для SSH,  
мы будем делать так:

- Node-приложение продолжает слушать **порт 3000** только внутри сервера.
- nginx слушает **порт 80** снаружи и проксирует запросы на `localhost:3000`.

### 6.1. Установка nginx

```bash
sudo apt update
sudo apt install -y nginx
```

Проверь статус:

```bash
sudo systemctl status nginx
```

Если всё ок, в браузере по адресу `http://VDS_IP` появится стандартная страница nginx.

### 6.2. Создание конфига для приложения

Создадим новый конфиг для нашего приложения:

```bash
sudo nano /etc/nginx/sites-available/vibe-todo
```

В открывшийся файл вставь (замени `your_domain_or_ip` на свой домен или IP):

```nginx
server {
    listen 80;
    server_name your_domain_or_ip;

    location / {
        proxy_pass http://127.0.0.1:3000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

Кратко, что здесь происходит:
- `listen 80;` — nginx слушает HTTP-порт 80.
- `server_name ...` — домен или IP, по которому будут приходить запросы.
- `proxy_pass http://127.0.0.1:3000;` — все запросы отправляются на локальный Node-сервер на порту 3000.

Сохрани файл в nano:
- `Ctrl + O` → Enter (сохранить)
- `Ctrl + X` (выйти)

### 6.3. Включение сайта и перезагрузка nginx

Создаём символическую ссылку, чтобы включить конфиг:

```bash
sudo ln -s /etc/nginx/sites-available/vibe-todo /etc/nginx/sites-enabled/vibe-todo
```

Опционально можно отключить дефолтный сайт:

```bash
sudo rm /etc/nginx/sites-enabled/default
```

Проверим конфигурацию:

```bash
sudo nginx -t
```

- Если выводит `syntax is ok` и `test is successful` — всё хорошо.

Перезапускаем nginx, чтобы применить изменения:

```bash
sudo systemctl reload nginx
```

Теперь nginx готов принимать запросы на порт 80 и проксировать их на Node-приложение.

---

## 7. Запуск приложения в фоне (чтобы не падало после выхода из SSH)

Если просто запустить `npm start`, сервер остановится, когда ты выйдешь из SSH.  
Чтобы этого не происходило, запустим приложение с помощью `nohup`:

```bash
cd ~/vibe-todo-app
nohup npm start > app.log 2>&1 &
```

Что здесь происходит:
- `nohup` — запускает процесс так, чтобы он не завершился при выходе из терминала.
- `npm start` — стандартный запуск приложения.
- `> app.log 2>&1` — перенаправляет весь вывод (stdout и stderr) в файл `app.log`.
- `&` — отправляет процесс в фон.

Проверить, что Node запущен:

```bash
ps aux | grep node
```

Теперь можно выйти из SSH (команда `exit` или `Ctrl + D`) — приложение продолжит работать.

Открывай в браузере:

```text
http://VDS_IP
```

или, если настроен домен:

```text
http://your_domain
```

Ты должен увидеть своё to‑do приложение.

---

## 8. Как остановить или перезапустить приложение

### 8.1. Найти процесс Node.js

```bash
ps aux | grep server.js
```

Или:

```bash
ps aux | grep node
```

В списке будет строка с `node server.js` или похожая.  
Запомни **PID** (число во втором столбце).

### 8.2. Остановить процесс

```bash
kill PID
```

Например, если PID = 1234:

```bash
kill 1234
```

Если процесс не останавливается:

```bash
kill -9 1234
```

### 8.3. Перезапустить

После остановки:

```bash
cd ~/vibe-todo-app
nohup npm start > app.log 2>&1 &
```

---

## 9. Что можно улучшить дальше

Когда базовый деплой заработает, можно:

- **Настроить HTTPS** через Let’s Encrypt (например, с помощью `certbot` для nginx).
- **Использовать pm2** вместо `nohup` — удобный менеджер процессов для Node.js.
- **Сделать systemd-сервис**, чтобы приложение поднималось автоматически при перезагрузке сервера.

Но для первого деплоя достаточно шагов 1–8 из этой инструкции.


